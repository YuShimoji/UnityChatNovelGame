# Project Roadmap: Chat Novel Engine (Post-Pivot)

**更新日**: 2026-02-11
**SSOT整合先**: `docs/GAME_DESIGN_DOCUMENT.md`  
**方針**: Vertical Slice優先 / チャットノベルエンジンのコア機能優先 / 物語テーマ分離（FoundPhone, Meta Horror）

---

## 1. 方針転換の要点

- 旧方針: テストカバレッジ拡充と仕様網羅を先行
- 新方針: まず「縦に切る」。最小の実プレイ導線を成立させる
- 対象: タイトル → チャット進行 → 分岐 → 待機 → セーブ/ロード
- ルール:
  - シナリオは手作り（自動生成しない）
  - テーマ依存機能はコアから分離
  - リソース管理はTBD（探索スレッドは可変化前提、バッテリーは当面除外）

---

## 2. Vertical Slice スコープロック（TASK_045 確定）

> **ロック日**: 2026-02-11
> このセクション以降、Vertical Slice の対象/非対象は本セクションを正とする。
> 変更にはユーザー承認が必要。

### 2.1 In-Scope（実装対象）

以下は Vertical Slice（Phase 1-3）で**実装する**機能・作業。

| # | 機能 | 対応Phase | GDD参照 |
|---|------|----------|---------|
| S-01 | タイトル画面 → チャット画面遷移 | Phase 1 | §6.2 |
| S-02 | ChatDialogueView（Yarn正式連携） | Phase 1 | §2.2, §2.3 |
| S-03 | メッセージ表示（左/右バブル、自動伸縮） | Phase 1 | §3.1 メッセージ表示 |
| S-04 | 選択肢表示・分岐（Yarn options） | Phase 1 | §3.1 |
| S-05 | 自動スクロール（新メッセージ追加時） | Phase 1 | §3.1 アニメーション |
| S-06 | 入力ロック/解除（NPC発話中の操作制御） | Phase 1 | §3.1 |
| S-07 | タイピングインジケーター（Typing コマンド） | Phase 1 | §3.1 カスタムコマンド |
| S-08 | SystemMessage コマンド | Phase 1 | §3.1 カスタムコマンド |
| S-09 | Wait / StartWait コマンド（待機フロー） | Phase 1 | §3.3 |
| S-10 | UnlockTopic コマンド（トピック獲得） | Phase 1 | §3.1 カスタムコマンド |
| S-11 | セーブ/ロード（3スロット、JSON） | Phase 1 | §5.2 |
| S-12 | サンプルストーリー（10-20行、2分岐、1演出コマンド） | Phase 1 | — |
| S-13 | スモークテスト（縦切り導線の破綻検知） | Phase 2 | — |
| S-14 | EditMode/PlayMode 最小チェック | Phase 2 | — |
| S-15 | 手動チェックリスト整備 | Phase 2 | — |
| S-16 | テーマ依存演出の設定分離（下準備） | Phase 3 | §4 |
| S-17 | Yarnシナリオ運用テンプレート整備 | Phase 3 | §2.3 |
| S-18 | 探索スレッドの設計整理（TBD維持前提） | Phase 3 | §3.4 |

### 2.2 Out-of-Scope（対象外・保留）

以下は Vertical Slice では**実装しない**。Phase 4 以降で判断する。

| # | 機能 | 理由 | GDD参照 |
|---|------|------|---------|
| X-01 | 探索スレッドの候補リソース確定 | TBDのまま維持（制約） | §3.4 |
| X-02 | バッテリー管理 | 当面除外（制約） | §3.4 |
| X-03 | ミニゲーム（Signal Sync 等） | コア導線に不要 | §3.5 |
| X-04 | トピック合成（Synthesis） | 導線成立に不要 | §3.2 |
| X-05 | PresentTopic（トピック選択UI） | 合成と連動。Phase 4+ | §3.1 カスタムコマンド |
| X-06 | Image コマンド（画像メッセージ） | 導線成立に不要 | §3.1 カスタムコマンド |
| X-07 | AddContact / ChangeStatus コマンド | 連絡先リスト未実装 | §3.1 カスタムコマンド |
| X-08 | 連絡先リスト画面 | Phase 4+ | — |
| X-09 | グリッチ Lv3-5（重い演出） | テーマ依存。コア不要 | §4.1 |
| X-10 | メタ演出（ゴーストタイピング、UI逃走、偽ダイアログ） | テーマ依存 | §4.2 |
| X-11 | サウンド/ハプティクス演出 | テーマ依存 | §4.3 |
| X-12 | Options パネル | Phase 4+ | §6.1 |
| X-13 | SafeArea / キーボード最終対応 | Phase 4+ | §6.1 |
| X-14 | オートセーブ | 3スロット手動で十分 | §5.2 |
| X-15 | Addressables 移行 | Phase 4+ | — |
| X-16 | 全面テストカバレッジ拡充 | スモーク優先 | — |
| X-17 | 物語の自動生成ロジック | 制約：手作り前提 | §0 |
| X-18 | Glitch Lv1-2（軽量演出） | Phase 3で設定分離のみ。実装はPhase 4+ | §4.1 |

### 2.3 判断基準（Worker向け迷ったら参照）

実装判断に迷った場合、以下のフローに従う:

1. **「タイトル → チャット → 分岐 → 待機 → セーブ/ロード」の導線上にあるか？**
   - Yes → In-Scope（S-xx に該当するか確認）
   - No → 2へ
2. **導線を壊さないための回帰検知に必要か？**
   - Yes → Phase 2 で対応
   - No → 3へ
3. **テーマ分離の「下準備」として必要か？（演出の実装は含まない）**
   - Yes → Phase 3 で対応
   - No → **Out-of-Scope（Phase 4+）**

**追加ルール**:
- GDD に記載があっても、上記フローで Out-of-Scope と判定されたものは実装しない
- Out-of-Scope 機能のスタブ/インターフェース定義は許可（ただし実装は空）
- 「あると便利」は理由にならない。導線成立に**必須**かどうかだけで判断する

---

## 3. 実行フェーズ

### Phase 0: スコープ固定 — **完了（TASK_045）**

**目的**
- Vertical Sliceの実装対象を固定し、保留項目を明示する

**成果物**
- 本ファイル §2（スコープロック・セクション）
- `AI_CONTEXT.md`（同期済み）
- `docs/tasks/` にフェーズ別タスク起票済み

**完了条件** ✅
- 「今回やる/やらない」がレビューで一意に判断できる

---

### Phase 1: 最小縦切り実装（2-4日）

**入口条件**
- Phase 0 完了（スコープロックが確定済み）
- `main` ブランチがコンパイルエラーなしでビルド通過

**目的**
- プレイヤーが「通しで1回遊べる」最小導線を成立させる

**実装/作業項目**
- VS1-1: `ChatDialogueView` 正式実装（Yarn正式連携）— S-02
- VS1-2: チャット基礎UXの固定 — S-03, S-04, S-05, S-06
  - 自動スクロール挙動
  - 入力ロック/解除
  - システムメッセージ
- VS1-3: 待機フロー（StartWait/SkipWait）の通し動作確認 — S-09
- VS1-4: セーブ/ロードを縦切り導線に接続 — S-11
- VS1-5: サンプルストーリー作成 — S-12

**成果物**
- 実行可能な最小シナリオ（タイトル開始から一連の進行）
- 実機能に紐づくコマンドの動作確認記録

**完了条件**
- タイトルからエンドポイントまで例外なく進行できる
- セーブ/ロードで進行破綻しない

---

### Phase 2: スモーク検証基盤（1-2日）

**入口条件**
- Phase 1 完了（縦切り導線が通しで動作する）
- PlayMode で最小シナリオが完走できる状態

**目的**
- 縦切り導線の回帰を最小コストで検知できる状態にする

**実装/作業項目**
- VS2-1: 「縦切りシナリオ破綻検知」用スモークテスト定義 — S-13
- VS2-2: 最低限のEditMode/PlayModeチェックを追加 — S-14
- VS2-3: 手動チェックリストを `docs/evidence/` 運用と接続 — S-15

**成果物**
- スモークチェック項目（自動+手動）
- 失敗時の記録テンプレート

**完了条件**
- 主要導線の破綻を短時間で再現・検出できる

---

### Phase 3: エンジン可変化（2-4日）

**入口条件**
- Phase 2 完了（スモーク検証基盤が稼働している）
- スモークテストが pass している状態

**目的**
- テーマ別ストーリーを載せ替え可能なコア構成へ寄せる

**実装/作業項目**
- VS3-1: テーマ依存演出の設定分離（プロファイル化の下準備）— S-16
- VS3-2: シナリオ資産テンプレート整備（Yarn運用テンプレ）— S-17
- VS3-3: 探索スレッドのリソース項目をTBDのまま扱える設計整理 — S-18
  - 候補は未定のまま保持
  - バッテリー管理は未導入を維持

**成果物**
- テーマ分離ガイド（実装メモ）
- シナリオ制作テンプレート

**完了条件**
- FoundPhone系とMeta Horror系を、コア改造なしで差し替え可能な構成方針が成立

---

### Phase 4: 拡張着手判断（以降）

**入口条件（ゲート）**
- Phase 1-3 の完了条件をすべて満たしている
- スモーク検証で連続3回の導線成功

**目的**
- Vertical Slice成立後に、初めて拡張開発へ進む

**候補項目**
- 連絡先リスト / AddContact / ChangeStatus
- Options / SafeArea最終調整
- オートセーブ強化
- Addressables移行計画
- グリッチ演出の本実装
- トピック合成 / PresentTopic

---

## 4. 優先順位ルール

1. 縦切り導線を壊すリスクの低減を最優先
2. コア機能に直結しない改善は後ろ倒し
3. テーマ依存の仕様追加は、分離可能な形でのみ許可
4. テストは「網羅性」より「導線破綻検知」を先に満たす

---

## 5. 保留・除外（現時点）

- 保留:
  - 探索スレッドの候補リソース詳細（TBD）
  - 重い演出仕様の本採用可否
- 当面除外:
  - バッテリー管理
  - 全面テストカバレッジ拡充を主目標にする計画

---

## 6. 進行管理メモ

- 進捗SSOT: `AI_CONTEXT.md`
- 仕様SSOT: `docs/GAME_DESIGN_DOCUMENT.md`
- 本ファイルは「次タスクの順序制御」に特化する
